<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Анкета</title>

	<script type="text/javascript" src="source/jquery-3.2.1.js"></script>

	<link rel="stylesheet" type="text/css" href="source/css/style.css">
	<link rel="stylesheet" type="text/css" href="source/css/select.css">
	<link rel="stylesheet" type="text/css" href="source/css/social.css">
	<link rel="stylesheet" type="text/css" href="source/css/final.css">

	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans" />
</head>

<body>
	<div class="paginat">
		<input type="button" class="button_step_1 step_button_active" value="1" style="color: #000000">
		<input type="button" class="button_step_2" disabled value="2">
		<input type="button" class="button_step_3" disabled value="3">
		<input type="button" class="button_step_4" disabled value="4">
	</div>

	<div id="final_button">
		<input type="button" class="go_to_start" value="Пройти заново">
	</div>

	<div class="prev_next">
		<input type="button" class="prev" value="〈  Предыдущий">
		<input type="button" class="next" value="Следующий  〉">
	</div>

	<form id="step_1" class="auth-form" method="post">

		<div class="step_title">1. Введите имя и e-mail</div>

		<input type="text" class="login" placeholder="Имя">
		</br>
		<input type="text" class="email" placeholder="E-mail">
		</br>
	</form>

	<form id="step_2" class="auth-form" method="post">

		<div class="step_title">2. Выберите страну и город</div>

		<ul id="select_countries">
			<li><a id="countries_header">Страна</a>
				<ul style="z-index: 1"></ul>
			</li>
		</ul>
				
		<ul id="select_cities">
			<li><a id="cities_header">Город</a>
				<ul style="z-index: 1"></ul>
			</li>
		</ul>
	</form>

	<form id="step_3" class="auth-form" method="post">
			
		<div class="step_title">3. Отметьте социальные сети</div>

		<p class="social_group social_group_facebook">
			<input type="checkbox" id="facebook_checkbox" class="checkbox">
			<label for="facebook_checkbox" class="social_network">Facebook</label>
			<input type="text" class="hide_social_link" id="facebook_login" style="border: 2px solid rgba(255, 255, 255, 0); border-radius: 2px;" placeholder="Ваша страница в Facebook">
		</p>

		<p class="social_group social_group_vk">
			<input type="checkbox" id="vk_checkbox" class="checkbox">
			<label for="vk_checkbox" class="social_network">Вконтакте</label>
			<input type="text" class="hide_social_link" id="vk_login" style="border: 2px solid rgba(255, 255, 255, 0); border-radius: 2px;" placeholder="Ваша страница в Вконтакте">
		</p>
		<p class="social_group social_group_twitter">
			<input type="checkbox" id="twitter_checkbox" class="checkbox">
			<label for="twitter_checkbox" class="social_network">Twitter</label>
			<input type="text" class="hide_social_link" id="twitter_login" style="border: 2px solid rgba(255, 255, 255, 0); border-radius: 2px;" placeholder="Ваша страница в Twitter">
		</p>
		<p class="social_group social_group_ok">
			<input type="checkbox" id="ok_checkbox" class="checkbox">
			<label for="ok_checkbox" class="social_network">Одноклассники</label>
			<input type="text" class="hide_social_link" id="ok_login" style="border: 2px solid rgba(255, 255, 255, 0); border-radius: 2px;" placeholder="Ваша страница в Одноклассниках">
		</p>
	</form>

	<form id="step_4" class="auth-form" method="post">
				
		<div class="step_title">4. Выберите любимого котика</div>

		<div class="cats cat1"></div>
		<div class="cats cat2"></div>
		<div class="cats cat3"></div>
		<div class="dogs dog4"></div></br>
		<p id='error_message_animal'>Вы выбрали собачку. А надо котика.</p>
		<p id='error_message_animal_none'>Вы забыли выбрать котика.</p>
	</form>

	<form id="step_5" class="auth-form" method="post">
		<p id="final_login"></p>
		<p id="final_email"></p>
		<p id="final_region"></p>
		<div id="final_cat"></div>
		<p id="final_social"></p>
	</form>

	<script>
		$(document).ready(function () {
			var form_login, form_email, form_country_name, form_city_name,
			form_facebook, form_vk, form_twitter, form_ok, form_cat;

			// Первый этап
			// Проверка полей на пустоту

			var from_step = 1; // С какого этапа пришли
			var to_step = 1; // На какой этап пришли
			var last_step = 1; // Последний доступный этап
			var max_step = 1; // Тоже последний доступный этап. Нужен для проверок различных частных случаев

			function validLoginEmail() {

				// Проверка логина
				var login = $(".login").val();
				var valid_login = /^[a-zа-яё][a-zа-яё0-9 _-]+$/gi;

				$(".login").removeClass("error_bording_login");
				$(".login").css("border-style", "none");
				$(".error_message_login").remove();

				if (!valid_login.test(login)) {

					if (!$(".login").hasClass("error_bording_login")) {

						if($(".login").val() == 0) {
							$("<span class='error_message_login'> - поле не может быть пустым</span>").insertAfter($(".login"));
						} else {
							$("<span class='error_message_login'> - логин введен некорректно</span>").insertAfter($(".login"));
						}
						$(".login").addClass("error_bording_login");
						$(".login").css("border-style", "solid");
					};

					$(".error_message_login").css("left", 100 + "%");
					$(".error_message_login").css("top", $(".login").position().top + $(".login").outerHeight(true) - $(".login").outerHeight()/2 - $(".error_message_login").outerHeight() / 2);
						form_login = "";
				} else {
					form_login = login;
					$(".login").removeClass("error_bording_login");
					$(".login").css("border-style", "none");
					$(".error_message_login").remove();
				};

				// Проверка e-mail
				var email = $(".email").val();
				var valid_email = /[a-z0-9_\.-]+@[a-z0-9-]+\.[a-z]/gi;

				$(".email").removeClass("error_bording_email");
				$(".email").css("border-style", "none");
				$(".error_message_email").remove();

				if (!valid_email.test(email)) {

					if (!$(".email").hasClass("error_bording_email")) {

						if($(".email").val() == 0) {
							$("<span class='error_message_email'> - поле не может быть пустым</span>").insertAfter($(".email"));
						} else {
							$("<span class='error_message_email'> - email введен некорректно</span>").insertAfter($(".email"));
						}
						$(".email").addClass("error_bording_email");
						$(".email").css("border-style", "solid");
					};

					$(".error_message_email").css("left", 100 + "%");
					$(".error_message_email").css("top", $(".email").position().top + $(".email").outerHeight(true) - $(".email").outerHeight()/2 - $(".error_message_email").outerHeight() / 2);
						form_email = "";
				} else {
					form_email = email;
					$(".email").removeClass("error_bording_email");
					$(".email").css("border-style", "none");
					$(".error_message_email").remove();
				};

				if (form_login && form_email) {
					$("#step_1").css("display", "none");
					$("#step_2").css("display", "inline-block");
					to_step = 2;
				}
			}





			//Второй этап
			var form_country_val = "";	// Для проверки номера страны

			// Получение списка стран
			$.getJSON("data/cities/countries.json", function(data){
				$.each(data, function(val, key) {
					$("#select_countries ul").append("<li><a class='countries_element' data-country="+val+">"+key+"</a></li>");
				});
			});

			// Клик по заголовку списка стран
			$(document).on("click", "#countries_header", function () {

				if ($("#select_countries ul").is(":visible")) {
					$("#select_countries ul").css("display", "none");
				} else {
					$("#select_countries ul").css("display", "block");
					$("#select_cities ul").css("display", "none");
				};

			});

			// Клик по названию страны из списка
			$(document).on("click", ".countries_element", function () {

				$("#select_countries").removeClass("error_bording_country");
				$("#select_countries").css("border-style", "none");
				$(".error_message_country").remove();

				// Если список городов не пуст - очистить его
				if ($(".cities_element").length > 0) { 
					$(".cities_element").remove();
					$("#cities_header").html("Город");
					$("#cities_header").css("color", "#bbbbbb");
					$("#select_cities ul").css("display", "none");
				};

				form_country_val = $(this).attr("data-country"); // Записали номер страны для загрузки спика нужных городов
				form_country_name = $(this).text(); // Записали название страны для последнего этапа
				$("#countries_header").html(form_country_name);
				$("#countries_header").css("color", "#000000");
				$("#select_countries ul").css("display", "none");
				$("#select_cities").css("display", "block");

				// Получение списка городов
				$.getJSON("data/cities/cities.json", function(data){
					$.each(data, function(val, key) {
						if(key.country == form_country_val) {
							$("#select_cities ul").css("display", "none");
							$("#select_cities ul").append("<li><a class='cities_element' data-cities="+val+">"+key.name+"</a></li>");
						};
					});
				});
			});

			// Клик по заголовку списка городов
			$(document).on("click", "#cities_header", function () {

				if ($("#select_cities ul").is(":visible")) {
					$("#select_cities ul").css("display", "none");
				} else {
					$("#select_cities ul").css("display", "block");
				};
			});

			// Клик по названию города из списка
			$(document).on("click", ".cities_element", function () { // Если выбрали город

				$("#select_cities").removeClass("error_bording_city");
				$("#select_cities").css("border-style", "none");
				$(".error_message_city").remove();

				form_city_name = $(this).text(); // записали название города для последнего этапа
				$("#cities_header").html(form_city_name);
				$("#cities_header").css("color", "#000000");
				$("#select_cities ul").css("display", "none");
			});

			function validCountryCity() {

				$("#select_countries").removeClass("error_bording_country");
				$("#select_countries").css("border-style", "none");
				$(".error_message_country").remove();

				$("#select_cities").removeClass("error_bording_city");
				$("#select_cities").css("border-style", "none");
				$(".error_message_city").remove();

				if ($("#countries_header").html() == "Страна") {
					$("<span class='error_message_country'> - поле не может быть пустым</span>").insertAfter($("#select_countries"));

					$(".error_message_country").css("left", 100 + "%");
					$(".error_message_country").css("top", $("#select_countries").position().top + $("#select_countries").outerHeight(true) - $("#select_countries").outerHeight()/2 - $(".error_message_country").outerHeight() / 2);

					$("#select_countries").addClass("error_bording_country");
					$("#select_countries").css("border-style", "solid");
				} 

				if ($("#cities_header").html() == "Город") {
					$("<span class='error_message_city'> - поле не может быть пустым</span>").insertAfter($("#select_countries"));

					$(".error_message_city").css("left", 100 + "%");
					$(".error_message_city").css("top", $("#select_cities").position().top + $("#select_cities").outerHeight(true) - $("#select_cities").outerHeight()/2 - $(".error_message_city").outerHeight() / 2);

					$("#select_cities").addClass("error_bording_city");
					$("#select_cities").css("border-style", "solid");
				} 

				if (($("#countries_header").html() != "Страна") && ($("#cities_header").html() != "Город")) {
					$("#step_2").css("display", "none");
					$("#step_3").css("display", "inline-block");
					to_step = 3;
				}

			};


			//Третий этап
			$(document).on("click", ".checkbox", function () {

				// Если чекбокс включился, то показать соответствующее поле для ввода
				if ($(this).prop("checked")) { 
					$(this).addClass("checkbox_check");
					$(this).siblings("input[type=text]").removeAttr("class");
				} else {
					$(this).removeClass("checkbox_check");
					$(this).siblings("input[type=text]").removeClass("error_bording_link");
					$(this).siblings("input[type=text]").addClass("hide_social_link");
					$(this).siblings("input[type=text]").css("border-color", "rgba(255, 255, 255, 0)");
					$(this).siblings("input[type=text]").val("");
					$(this).siblings("span").remove("#error_message_link");
				}
			});

			// Проверка каждого поля на корректное заполнение
			function validSocial() {

				$(".error_message_checkbox").remove();

				form_facebook = $("#facebook_login").val();
				form_vk = $("#vk_login").val();
				form_twitter = $("#twitter_login").val();
				form_ok = $("#ok_login").val();

				
				var valid_link_facebook = /((http|https):\/\/)?(www.)?(fb|facebook).com\/[a-z0-9_\.-]+$/gi;
				var valid_link_vk = /((http|https):\/\/)?(www.)?vk.com\/[a-z0-9_\.-]+$/gi;
				var valid_link_twitter = /((http|https):\/\/)?(www.)?twitter.com\/[a-z0-9_\.-]+$/gi;
				var valid_link_ok = /((http|https):\/\/)?(www.)?ok.ru\/[a-z0-9_\.-]+$/gi;

				// Проверка Facebook
				if ($("#facebook_login").siblings("#error_message_link")) {
					$("#facebook_login").siblings().remove("#error_message_link");
					$("#facebook_login").css("border-color", "rgba(255, 255, 255, 0)");
					$("#facebook_login").removeClass("error_bording_link");
					form_facebook = $("#facebook_login").val(); // Записали ссылку на профиль в Facebook для последнего этапа
				};

				if (!valid_link_facebook.test(form_facebook) && !$("#facebook_login").hasClass("hide_social_link")) {

					$("<span id='error_message_link' class='error_message_link'> - введите корректный адрес</span>").insertAfter($("#facebook_login"));

					$("#facebook_login").css("border-color", "#ff0000");
					$("#facebook_login").addClass("error_bording_link");
				};

				// Проверка Вконтакте
				if ($("#vk_login").siblings("#error_message_link")) {
					$("#vk_login").siblings().remove("#error_message_link");
					$("#vk_login").css("border-color", "rgba(255, 255, 255, 0)");
					$("#vk_login").removeClass("error_bording_link");
					form_vk = $("#vk_login").val(); // Записали ссылку на профиль в Вконтакте для последнего этапа
				};

				if (!valid_link_vk.test(form_vk) && !$("#vk_login").hasClass("hide_social_link")) {

					$("<span id='error_message_link' class='error_message_link'> - введите корректный адрес</span>").insertAfter($("#vk_login"));

					$("#vk_login").css("border-color", "#ff0000");
					$("#vk_login").addClass("error_bording_link");
				};

				// Проверка Twitter
				if ($("#twitter_login").siblings("#error_message_link")) {
					$("#twitter_login").siblings().remove("#error_message_link");
					$("#twitter_login").css("border-color", "rgba(255, 255, 255, 0)");
					$("#twitter_login").removeClass("error_bording_link");
					form_twitter = $("#twitter_login").val(); // Записали ссылку на профиль в Twitter для последнего этапа
				};

				if (!valid_link_twitter.test(form_twitter) && !$("#twitter_login").hasClass("hide_social_link")) {

					$("<span id='error_message_link' class='error_message_link'> - введите корректный адрес</span>").insertAfter($("#twitter_login"));

					$("#twitter_login").css("border-color", "#ff0000");
					$("#twitter_login").addClass("error_bording_link");
				};

				// Проверка Одноклассников
				if ($("#ok_login").siblings("#error_message_link")) {
					$("#ok_login").siblings().remove("#error_message_link");
					$("#ok_login").css("border-color", "rgba(255, 255, 255, 0)");
					$("#ok_login").removeClass("error_bording_link");
					form_ok = $("#ok_login").val(); // Записали ссылку на профиль в Одноклассниках для последнего этапа
				};
				if (!valid_link_ok.test(form_ok) && !$("#ok_login").hasClass("hide_social_link")) {

					$("<span id='error_message_link' class='error_message_link'> - введите корректный адрес</span>").insertAfter($("#ok_login"));

					$("#ok_login").css("border-color", "#ff0000");
					$("#ok_login").addClass("error_bording_link");
				};

				// Если ничего не выбрано, то получаем сообщение об ошибке
				// Если же все ссылки корректны, то можно двигаться дальше
				if ((form_facebook == "") && (form_vk == "") && (form_twitter == "") && (form_vk == "")) {
					$("<span id='error_message_checkbox' class='error_message_checkbox'>Необходимо ввести хотя бы один адрес</span>").insertBefore($(".social_group_facebook"));
					

				} else if (!(((form_facebook == "" || $("#facebook_login").hasClass("error_bording_link")) && !$("#facebook_login").hasClass("hide_social_link"))  ||
					((form_vk == "" || $("#vk_login").hasClass("error_bording_link")) && !$("#vk_login").hasClass("hide_social_link")) ||
					((form_twitter == "" || $("#twitter_login").hasClass("error_bording_link")) && !$("#twitter_login").hasClass("hide_social_link")) ||
					((form_ok == "" || $("#ok_login").hasClass("error_bording_link")) && !$("#ok_login").hasClass("hide_social_link")))) {

					$("#step_3").css("display", "none");
					$("#step_4").css("display", "inline-block");
					to_step = 4;
					$(".next").val("Завершить");
					$(".next").css("background", "#ff9800");
					$(".next").css("color", "#ffffff");
				};
			};

			// Четвертый этап
			// Клик по изображениям. Если выбрана собачка, то показываем предупреждение
			$(document).on("click", "#step_4 div", function() {

				if ($(this).hasClass("cats")) {
					$(".cats").css("border", "4px solid #f5f5f5");
					$(this).css("display", "block");
					$(this).css("border", "4px solid #ff9100");
					$("#error_message_animal").css("display", "none");
					$("#error_message_animal_none").css("display", "none");
					$(".dog4").css("border", "4px solid #f5f5f5");
					form_cat = $(this).clone(); // Записываем котика для последнего этапа
				} else if ($(this).hasClass("dogs")) {
					$("#error_message_animal_none").css("display", "none");
					$(".cats").css("border", "4px solid #f5f5f5");
					$(".dog4").css("border", "4px solid #ff9100");
					form_cat = "";
				};
			});

			function validCat() {
				if (form_cat) {
					$("#step_4").css("display", "none");
					$("#step_5").css("display", "inline-block");
					$(".paginat").css("display", "none");
					$(".prev_next").css("display", "none");
					$(".go_to_start").css("display", "inline-block");
					to_step = 5;
					final_data();
				} else if (($(".dog4").css("border")) == "4px solid rgb(255, 145, 0)") {
					$("#error_message_animal").css("display", "block");
				} else {
					$("#error_message_animal_none").css("display", "block");
				}
			}



			// Пятый этап
			function final_data() {

				// Вставляем на нужное место все полученные данные
				$("#final_login").append(form_login);
				$("#final_email").append(form_email);

				var final_region = form_city_name + ", " + form_country_name;
				$("#final_region").append(final_region);

				$(form_cat).css("border", "4px solid #ffffff");
				$("#final_cat").append(form_cat);
				
				if ($("#final_cat div").hasClass("cat1")) {
					$(".cat1").css("left", "auto");
					$("#final_cat div").css("background-size", "275px 200px").css("background-position", "60% 20%");
				} else if ($("#final_cat div").hasClass("cat2")) {
					$("#final_cat div").css("background-size", "312px 204px").css("background-position", "30% 20%");
				} else {
					$(".cat3").css("left", "auto");
					$("#final_cat div").css("background-size", "260px 190px").css("background-position", "70% 20%");
				};

				$("#final_cat div").toggleClass("cats final_cat");

				var final_social = "";
				var final_facebook, final_vk, final_twitter, final_ok = "";

				// Сокращаем адреса соцсетей, если они были введены с http, https, www.
				// Дополнительно меняем facebook на fb, если было введен именно facebook.
				// Для осуществления корректных переходов делаем все ссылки абсолютными
				var valid_final_social = /(http:\/\/|https:\/\/)?(www.)?.+/i;

				form_facebook = form_facebook.replace(/(http:\/\/|https:\/\/)?(www.)?facebook+/i, "fb");
				final_facebook = form_facebook.replace(/fb/, "https://fb");
				if (form_facebook.length != 0) {
					final_social += "<span class='social_name'>Facebook:</span> " + "<a href=" + final_facebook + ">" + form_facebook + "</a></br>";
				};

				form_vk = form_vk.replace(/(http:\/\/|https:\/\/)?(www.)?/i, "");
				final_vk = form_vk.replace(/vk/, "https://vk");
				if (form_vk.length != 0) {
					final_social += "<span class='social_name'>Вконтакте:</span> " + "<a href=" + final_vk + ">" + form_vk +" </a></br>";
				};

				form_twitter = form_twitter.replace(/(http:\/\/|https:\/\/)?(www.)?/i, "");
				final_twitter = form_twitter.replace(/twitter/, "https://twitter");
				if (form_twitter.length != 0) {
					final_social += "<span class='social_name'>Twitter:</span> " + "<a href=" + final_twitter + ">" + form_twitter + "</a></br>";
				};

				form_ok = form_ok.replace(/(http:\/\/|https:\/\/)?(www.)?/i, "");
				final_ok = form_ok.replace(/ok/, "https://ok");
				if (form_ok.length != 0) {
					final_social += "<span class='social_name'>Одноклассники:</span> " + "<a href=" + final_ok + ">" + form_ok + "</a></br>";
				};

				$("#final_social").append(final_social);

				//Динамическое изменение ширины блока в зависимости от ширины контента
				var max_width = 0;
				$("#step_5 p").each(function function_name(argument) {
					if ($(this).width() > max_width) {
						max_width = $(this).width();
					}
				});
				var step_5_width = 25 + max_width + 50 + $(".final_cat").width() + 24 + "px";
				$("#step_5").css("width", step_5_width);
			}




			// Переходы по кнопкам "Следующий"
			$(document).on("click", ".next", function () {
				if (to_step == 1) {
					validLoginEmail();
				} else if (to_step == 2) {
					validCountryCity();
				} else if (to_step == 3) {
					validSocial();
				} else if (to_step == 4) {
					validCat();
				};
			});

			// Переходы по кнопкам "Предыдущий"
			$(document).on("click", ".prev", function () {
				if (to_step == 2) {
					to_step = 1;
					$("#step_2").css("display", "none");
					$("#step_1").css("display", "inline-block");
				} else if (to_step == 3) {
					to_step = 2;
					$("#step_3").css("display", "none");
					$("#step_2").css("display", "inline-block");
				} else if (to_step == 4) {
					to_step = 3;
					$("#step_4").css("display", "none");
					$("#step_3").css("display", "inline-block");
					$(".next").val("Следующий  〉");
					$(".next").css("background", "#ffffff");
					$(".next").css("color", "#ff9800");
				};
			});

		});
	</script>
</body>
</html>